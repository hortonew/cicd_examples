name: Conditional Steps Example

on:
    push:
        branches: [main]
    pull_request:
        branches: [main]
    workflow_dispatch:

jobs:
    build:
        name: Build
        runs-on: ubuntu-latest
        steps:
            - name: Checkout code
              uses: actions/checkout@v4

            # Run only on push events
            - name: Push only
              if: github.event_name == 'push'
              run: echo "ğŸš€ This only runs on push"

            # Run only on pull requests
            - name: PR only
              if: github.event_name == 'pull_request'
              run: echo "ğŸ” This only runs on PRs"

            # Run only on main branch
            - name: Main branch only
              if: github.ref_name == 'main'
              run: echo "ğŸ­ This only runs on main"

            # Skip if commit message contains [skip ci]
            - name: Skippable step
              if: "!contains(github.event.head_commit.message, '[skip ci]')"
              run: echo "âœ… No [skip ci] in commit message"

    deploy:
        name: Deploy
        runs-on: ubuntu-latest
        needs: build
        # Entire job is conditional
        if: github.ref_name == 'main' && github.event_name == 'push'
        steps:
            - name: Deploy to production
              run: echo "ğŸš€ Deploying to production!"

    notify:
        name: Notify
        runs-on: ubuntu-latest
        needs: [build, deploy]
        if: always()
        steps:
            - name: Notify on failure
              id: failure-notify
              if: contains(needs.*.result, 'failure')
              run: echo "âŒ Something failed!"

            - name: Notify on success
              if: steps.failure-notify.outcome == 'skipped'
              run: echo "âœ… All good!"
